<html>

<head>
    <link rel="stylesheet" type="text/css" href="/css/style.css">
</head>

<script>
    // this whole request-specific setup is not very good;
    // TODO abstract this to a more scalable system
    // TODO also maybe just separate all of the js to files; keep html in the html
    function HandleLogoutResponse(response) {
        var responseObj = JSON.parse(response);
        console.log(responseObj);
        res = responseObj[1];
        var success;

        if (res === false) {
            success = false;
        } else {
            success = res[1];
        }

        //	document.getElementById("textResponse").innerHTML = response+"<p>";	
        // document.getElementById("textResponse").innerHTML = "response: " + responseObj[0] + "<p>";

        if (success) {
            // clear cookie
            document.cookie = "session_id=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT";
            window.location.href = "index.html";
        }
    }

    function SendLogoutRequest(session_id) {
        var request = new XMLHttpRequest();
        request.open("POST", "webserver.php", true);
        request.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
        request.onreadystatechange = function () {

            if ((this.readyState == 4) && (this.status == 200)) {
                HandleLogoutResponse(this.responseText);
            }
        }
        request.send("type=logout&session_id=" + session_id);
    }

    function getCookie(name) {
        var value = "; " + document.cookie;
        var parts = value.split("; " + name + "=");
        if (parts.length === 2) return parts.pop().split(";").shift();
        return null;
    }
</script>

<header>
    <div class="navbar" style="display: flex; align-items:center;">
        <a href="/home.php" style="padding: 0px; margin-right: 100px; margin-left: 10px; border-style: none;">
            <img src="/img/logo.png" width="96px" style="image-rendering: crisp-edges; float: left;" class="logo">
        </a>
        <a href="/build.php" style="margin-left: auto;">Build</a>
        <a href="/component_finder.php">Component Finder</a>
        <a href="/forum.php">Forum</a>
        <a href="/marketplace.php" style="margin-right: auto;">Marketplace</a>
        <button type="button" id="logout_button">Log out</button>
        <script>
            document.getElementById("logout_button").addEventListener('click', function () {
                var session_id = getCookie("session_id");
                SendLogoutRequest(session_id);
            });
        </script>

    </div>
</header>

</html>